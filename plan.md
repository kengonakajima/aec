# エコーキャンセラ実装計画

## 目標
macOSでNode.jsを用いて、マイクから音声を入力しスピーカーからそのまま再生するプログラムを作成する。ハウリングを防ぐため、libwebrtc AEC3のAdaptive FIR FilterとMatched Filterの概念を参考にした独自のPure JavaScriptエコーキャンセラを実装する。

## 実装アプローチ
再現可能なテスト環境でエコーキャンセルアルゴリズムを開発してから、実際のマイク・スピーカーに移行する段階的アプローチを採用。

## フェーズ1: 再現可能なテスト環境構築

### 1. counting48k.wav解析
- ファイル形式・サンプリングレート確認
- チャンネル数、ビット深度等の詳細情報取得

### 2. Node.js環境構築
- WAV再生・録音ライブラリ導入
- macOS環境での音声入出力設定

### 3. 同時再生録音システム
- counting48k.wav再生中に録音するプログラム作成
- タイミング同期の実装

### 4. 回り込み音データ生成
- counting48krec.wav（回り込み音）作成
- スピーカーからマイクへの音響カップリング記録

## フェーズ2: オフラインエコーキャンセル開発

### 5. エコー除去アルゴリズム
- 元信号（counting48k.wav）を回り込み音（counting48krec.wav）から除去
- 基本的な信号減算アルゴリズム実装

### 6. 効果検証
- エコー除去前後の音質比較
- 定量的な除去効果測定

## フェーズ3: アルゴリズム高度化

### 7. Adaptive FIR Filter
- Pure JavaScript実装
- libwebrtc AEC3の概念を参考にした適応フィルタ

### 8. Matched Filter
- Pure JavaScript実装
- 残響とノイズ除去機能

## フェーズ4: リアルタイム実装

### 9. リアルタイム統合
- 実際のマイク・スピーカーでの動作
- 低レイテンシ処理の実現

## 期待される効果
- **再現性**: 同じ音源ファイルで一貫したテスト
- **検証性**: エコー除去前後の定量的比較
- **段階的開発**: オフライン→リアルタイムの順次移行

## 技術的考慮点
- サンプリングレート: 48kHz（counting48k.wavに合わせる）
- フレームサイズ: 10-20ms単位での処理
- レイテンシ: <50ms目標（リアルタイム実装時）
- Pure JavaScript: WebAssemblyは使わずJS実装

## 実装制約
- **Pure JavaScript実装**: FFT以外はライブラリを一切使用せず、独自にコードを書いて実装
- すべてのアルゴリズム（Adaptive FIR Filter, Matched Filter等）を自前で実装
- 外部依存を最小限に抑制し、アルゴリズムの理解と制御を重視